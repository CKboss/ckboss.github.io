title: HDOJ 4436 str2int SAM
date: 2015-09-15 09:48:28
tags:
- SAM

categories:
- acm_字符串

---

将所有数字添加上分隔符连接在一起,建立后缀自动机.
拓扑排序后,从头扫一遍就可以了.

---
# str2int

Time Limit: 6000/3000 MS (Java/Others)    Memory Limit: 131072/131072 K (Java/Others)
Total Submission(s): 1712    Accepted Submission(s): 608


##### Problem Description
In this problem, you are given several strings that contain only digits from '0' to '9', inclusive.
An example is shown below.
101
123
The set S of strings is consists of the N strings given in the input file, and all the possible substrings of each one of them.
It's boring to manipulate strings, so you decide to convert strings in S into integers.
You can convert a string that contains only digits into a decimal integer, for example, you can convert "101" into 101, "01" into 1, et al.
If an integer occurs multiple times, you only keep one of them. 
For example, in the example shown above, all the integers are 1, 10, 101, 2, 3, 12, 23, 123.
Your task is to calculate the remainder of the sum of all the integers you get divided by 2012.
 

##### Input
There are no more than 20 test cases.
The test case starts by a line contains an positive integer N.
Next N lines each contains a string consists of one or more digits.
It's guaranteed that 1≤N≤10000 and the sum of the length of all the strings ≤100000.
The input is terminated by EOF.
 

##### Output
An integer between 0 and 2011, inclusive, for each test case.

<!-- more -->

```
Sample Input
5
101
123
09
000 
1234567890

Sample Output
202

```

Source
2012 Asia Tianjin Regional Contest
 


```c++

/* ***********************************************
Author        :CKboss
Created Time  :2015年09月14日 星期一 22时57分21秒
File Name     :HDOJ4436.cpp
************************************************ */

#include <iostream>
#include <cstdio>
#include <cstring>
#include <algorithm>
#include <string>
#include <cmath>
#include <cstdlib>
#include <vector>
#include <queue>
#include <set>
#include <map>

using namespace std;

const int CHAR=12,maxn=200000;

struct SAM_Node
{
    SAM_Node *fa,*next[CHAR];
    int len,id,pos;
    SAM_Node(){}
    SAM_Node(int _len)
    {
        fa=0; len=_len;
        memset(next,0,sizeof(next));
    }
};

SAM_Node *SAM_root,*SAM_last;
SAM_Node SAM_node[maxn];
int SAM_size;

SAM_Node *newSAM_Node(int len)
{
    SAM_node[SAM_size]=SAM_Node(len);
    SAM_node[SAM_size].id=SAM_size;
    return &SAM_node[SAM_size++];
}

SAM_Node *newSAM_Node(SAM_Node *p)
{
    SAM_node[SAM_size]=*p;
    SAM_node[SAM_size].id=SAM_size;
    return &SAM_node[SAM_size++];
}

void SAM_init()
{
    SAM_size=0;
    SAM_root=SAM_last=newSAM_Node(0);
    SAM_node[0].pos=0;
}

void SAM_add(int x,int len)
{
    SAM_Node *p=SAM_last,*np=newSAM_Node(p->len+1);
    np->pos=len; SAM_last=np;
    for(;p&&!p->next[x];p=p->fa)
        p->next[x]=np;
    if(!p)
    {
        np->fa=SAM_root;
        return ;
    }
    SAM_Node *q=p->next[x];
    if(q->len==p->len+1)
    {
        np->fa=q; return ;
    }
    SAM_Node *nq=newSAM_Node(q);
    nq->len=p->len+1;
    q->fa=nq; np->fa=nq;
    for(;p&&p->next[x]==q;p=p->fa)
        p->next[x]=nq;
}

void SAM_build(const char* s)
{
    SAM_init();
    int len=strlen(s);
    for(int i=0;i<len;i++) 
        SAM_add(s[i]-'0',i+1);
}

const int mod=2012;
int ans;

SAM_Node* top[maxn];
int c[maxn],cnt[maxn],sum[maxn];

void solve(int len)
{
    ans=0;

    memset(c,0,sizeof(c)); 
    for(int i=0;i<SAM_size+10;i++) cnt[i]=sum[i]=0;

    for(int i=0;i<SAM_size;i++) c[SAM_node[i].len]++;  
    for(int i=1;i<=len;i++) c[i]+=c[i-1];  
    for(int i=0;i<SAM_size;i++) top[--c[SAM_node[i].len]]=&SAM_node[i]; 

    cnt[SAM_root->id]=1;

    SAM_Node *p,*q;

    for(int i=0;i<SAM_size;i++)
    {
        p=top[i];
        for(int j=0;j<10;j++)
        {
            if(i==0&&j==0) continue;
            if(p->next[j])
            {
                q=p->next[j];

                cnt[q->id]=(cnt[q->id]+cnt[p->id])%mod;
                sum[q->id]=(sum[q->id]+sum[p->id]*10+cnt[p->id]*j)%mod;
            }
        }
        ans=(ans+sum[p->id])%mod;
    }
}

void DEBUG()
{
    for(int i=0;i<SAM_size;i++)
    {
        for(int j=0;j<=10;j++)
        {
            if(SAM_node[i].next[j])
            {
                printf("%d --- %c ---> %d\n",i,j+'0',SAM_node[i].next[j]->id);
            }
        }
    }
}

int len;
char tmp[maxn],str[maxn];

int main()
{
    //freopen("in.txt","r",stdin);
    //freopen("out.txt","w",stdout);
    
    int n;
    while(scanf("%d",&n)!=EOF)
    {
        len=0;
        for(int i=0;i<n;i++)
        {
            scanf("%s",tmp);
            int tl=strlen(tmp);
            for(int j=0;j<tl;j++)
                str[len++]=tmp[j];
            str[len++]=':';
        }
        str[len]=0;
        SAM_build(str);
        solve(len);
        printf("%d\n",ans%mod);
    }
    
    return 0;
}
```